\chapter{Ergonomics of Spoofax}

Now that we've implemented a feature-rich dependently typed language in Statix, this chapter discusses the experience, and recommends some features which might improve the experience. 

\section{Statix}

Statix is a simple language, not supporting too many complex features. This works well in some ways, but having some more features available could improve the experience drastically. Some features that would've helped this project create better code are:

\begin{enumerate}
	\item Nested constraints: Defining a constraint that can use the metavariables of a parent constraint. This works similar to nested function definitions. For example, for type checking datatypes:
	\begin{lstlisting}
typeOfExpr_(s, DataTypeDecl(n, ps, is, ue, cs, b)) = ... :-

	isStrictlyPositive : (scope * Expr)
	isStrictlyPositive(s, FnType(...)) = ...
	\end{lstlisting}
	The definition of \verb|isStrictlyPositive| can then use all the metavariables of \verb|DataTypeDecl| without having to explicitly pass them.
	
	\item In order to implement more powerful inference algorithms, it would be useful to have a mechanism to check if metavariables have been instantiated or not. Since the order in which Statix evaluates constraints is so dynamic, we're not entirely sure how this mechanism would be implemented. More research is needed on this.
	
	\item Generic constraints. For example, we created two separate relations for reversing lists of different types, making these one generic function would've been better. This was the only case where this feature would've been useful for this thesis, but it may be more useful for other work.
	
	\item A better way to control the errors generated by Statix, such that users of the language get good errors. Statix does support \texttt{expr | error "Error text here"} annotations, but these don't allow constraints that instantiate metavariables on the left hand side whereas this would be needed for good error messages for dependently typed languages, since \verb|expectBetaEq| may infer variables.
\end{enumerate}

\section{Spoofax}



- performance
- testing works well
- specifying grammars is still difficult
- debugging (statix tests are not great)